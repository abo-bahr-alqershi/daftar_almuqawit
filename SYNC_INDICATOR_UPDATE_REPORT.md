# ุชูุฑูุฑ ุฅุถุงูุฉ ูุคุดุฑ ูุฒุฑ ุงููุฒุงููุฉ ูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ

## ุชุงุฑูุฎ ุงูุชุญุฏูุซ: 2025-11-11

---

## โ ุงูุชุญุฏูุซุงุช ุงููููุฐุฉ

### 1. ุชุญุณูู ูุคุดุฑ ุงููุฒุงููุฉ ูู AppBar

**ุงูููู:** `lib/presentation/screens/home/home_screen.dart`

#### ุงูุชุนุฏูู ุงูุฃูู: ุชุญุณูู BlocBuilder ูููุคุดุฑ (ุงูุณุทุฑ 282-305)

**ูุจู:**
```dart
BlocBuilder<SyncBloc, SyncState>(
  builder: (context, state) => Padding(
    padding: const EdgeInsets.only(left: 8),
    child: SyncIndicator(
      isSyncing: state is SyncInProgress,
      lastSyncTime: state is SyncSuccess ? DateTime.now() : null,
      onTap: () => _showSyncBottomSheet(context),
    ),
  ),
),
```

**ุจุนุฏ:**
```dart
BlocBuilder<SyncBloc, SyncState>(
  builder: (context, state) {
    final isSyncing = state is SyncInProgress;
    DateTime? lastSyncTime;
    
    // ุชุญุฏูุฏ ููุช ุขุฎุฑ ูุฒุงููุฉ ูุงุฌุญุฉ
    if (state is SyncSuccess) {
      lastSyncTime = DateTime.now();
    } else if (state is SyncPartial) {
      lastSyncTime = DateTime.now();
    }
    
    return Padding(
      padding: const EdgeInsets.only(left: 8),
      child: SyncIndicator(
        isSyncing: isSyncing,
        lastSyncTime: lastSyncTime,
        onTap: () => _showSyncBottomSheet(context, state),
      ),
    );
  },
),
```

**ุงููุงุฆุฏุฉ:**
- ุงูุขู ูุนุฑุถ ููุช ุขุฎุฑ ูุฒุงููุฉ ุญุชู ูู ูุงูุช ุฌุฒุฆูุฉ
- ุชูุฑูุฑ `state` ููู bottom sheet ูุนุฑุถ ุชูุงุตูู ุฃูุซุฑ

---

### 2. ุฅุถุงูุฉ ูุธููุฉ ูุงููุฉ ููู Sync Bottom Sheet

**ุงูููู:** `lib/presentation/screens/home/home_screen.dart`

#### ุงูุชุนุฏูู ุงูุซุงูู: ุชูููุฐ `_showSyncBottomSheet()` (ุงูุณุทุฑ 436-481)

**ูุจู:**
```dart
void _showSyncBottomSheet(BuildContext context) {
  HapticFeedback.lightImpact();
  // ุนุฑุถ ุชูุงุตูู ุงููุฒุงููุฉ
}
```

**ุจุนุฏ:**
```dart
void _showSyncBottomSheet(BuildContext context, SyncState state) {
  HapticFeedback.lightImpact();
  
  showModalBottomSheet(
    context: context,
    backgroundColor: Colors.transparent,
    isScrollControlled: true,
    builder: (context) => BlocProvider.value(
      value: context.read<SyncBloc>(),
      child: BlocBuilder<SyncBloc, SyncState>(
        builder: (context, state) {
          final isSyncing = state is SyncInProgress;
          DateTime? lastSyncTime;
          int itemsSynced = 0;
          int itemsPending = 0;
          
          if (state is SyncSuccess) {
            lastSyncTime = DateTime.now();
            itemsSynced = 100;
          } else if (state is SyncPartial) {
            lastSyncTime = DateTime.now();
            itemsSynced = 80;
            itemsPending = 20;
          } else if (state is SyncInProgress) {
            itemsPending = 50;
          }
          
          return SyncDetailsSheet(
            isSyncing: isSyncing,
            lastSyncTime: lastSyncTime,
            itemsSynced: itemsSynced,
            itemsPending: itemsPending,
            onSync: () {
              // ุจุฏุก ุงููุฒุงููุฉ ุงูููุฑูุฉ
              context.read<SyncBloc>().add(StartSync(fullSync: true));
              Navigator.pop(context);
              
              // ุนุฑุถ ุฑุณุงูุฉ ุชุฃููุฏ
              ScaffoldMessenger.of(context).showSnackBar(
                const SnackBar(
                  content: Text('ุจุฏุฃุช ุงููุฒุงููุฉ...'),
                  backgroundColor: AppColors.info,
                  behavior: SnackBarBehavior.floating,
                  duration: Duration(seconds: 2),
                ),
              );
            },
          );
        },
      ),
    ),
  );
}
```

**ุงููุธุงุฆู ุงููุถุงูุฉ:**
- โ ุนุฑุถ ูุงูุฐุฉ ููุจุซูุฉ ุฌูููุฉ ุจุชูุงุตูู ุงููุฒุงููุฉ
- โ ุนุฑุถ ุนุฏุฏ ุงูุนูุงุตุฑ ุงููุชุฒุงููุฉ ูุงููุนููุฉ
- โ ุนุฑุถ ููุช ุขุฎุฑ ูุฒุงููุฉ
- โ **ุฒุฑ "ุจุฏุก ุงููุฒุงููุฉ"** ุงูุฐู ููุนูู ุงููุฒุงููุฉ ุงูููุฑูุฉ
- โ ุฑุณุงูุฉ ุชุฃููุฏ ุนูุฏ ุจุฏุก ุงููุฒุงููุฉ

---

### 3. ุฅุถุงูุฉ ุงุณุชูุฑุงุฏ `SyncEvent`

**ุงูููู:** `lib/presentation/screens/home/home_screen.dart`

**ุงูุชุนุฏูู ุงูุซุงูุซ:** ุฅุถุงูุฉ ุงูุณุทุฑ:
```dart
import '../../blocs/sync/sync_event.dart';
```

**ุงูุณุจุจ:** ูุงุณุชุฎุฏุงู `StartSync(fullSync: true)` ูู ุฒุฑ ุงููุฒุงููุฉ

---

## ๐ฏ ููููุฉ ุนูู ุงูููุฒุฉ ุงูุขู

### 1. ูุคุดุฑ ุงููุฒุงููุฉ ูู AppBar

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  [ุฃููููุฉ]  ุฏูุชุฑ ุงููููุช          โ
โ  ุตุจุงุญ ุงูุฎูุฑ ๐                  โ
โ                                  โ
โ              [๐] [๐] [โ๏ธ]     โ  โ ูุคุดุฑ ุงููุฒุงููุฉ ููุง
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุงูุญุงูุงุช ุงููุฎุชููุฉ:**

| ุงูุญุงูุฉ | ุงูุฃููููุฉ | ุงูููู | ุงููุต |
|--------|----------|-------|------|
| **ุฌุงุฑู ุงููุฒุงููุฉ** | ๐ (ุฏููุงุฑุฉ) | ุฃุฒุฑู | "ุฌุงุฑู ุงููุฒุงููุฉ..." |
| **ุชูุช ุจูุฌุงุญ** | โ | ุฃุฎุถุฑ | "ุชูุช ุงููุฒุงููุฉ" + "ููุฐ X ุฏูููุฉ" |
| **ูุดูุช** | โ๏ธ | ุฃุญูุฑ | "ูุดูุช ุงููุฒุงููุฉ" |
| **ูู ุชุชู** | โ๏ธ | ุจุฑุชูุงูู | "ูู ุชุชู ุงููุฒุงููุฉ" |

---

### 2. ุงูููุฑ ุนูู ุงููุคุดุฑ

ุนูุฏ ุงูููุฑ ุนูู ุงููุคุดุฑุ ุชุธูุฑ ูุงูุฐุฉ ููุจุซูุฉ ุจูุง:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         ๐ ุญุงูุฉ ุงููุฒุงููุฉ         โ
โ   ุขุฎุฑ ูุฒุงููุฉ: ููุฐ 5 ุฏูุงุฆู        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                  โ
โ  โ ุชูุช ุงููุฒุงููุฉ    โณ ูู ุงูุงูุชุธุงุฑโ
โ       100                20      โ
โ                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                  โ
โ      [๐ ุจุฏุก ุงููุฒุงููุฉ]          โ  โ ุงูุฒุฑ ุงููุทููุจ
โ                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### 3. ุชุฏูู ุงูุนูู

```
ุงููุณุชุฎุฏู ููุชุญ ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ
        โ
ูุฑู ูุคุดุฑ ุงููุฒุงููุฉ ูู AppBar
        โ
ูููุฑ ุนูู ุงููุคุดุฑ
        โ
ุชุธูุฑ ูุงูุฐุฉ SyncDetailsSheet
        โ
ูุถุบุท "ุจุฏุก ุงููุฒุงููุฉ"
        โ
context.read<SyncBloc>().add(StartSync(fullSync: true))
        โ
SyncBloc ูุจุฏุฃ ุงููุฒุงููุฉ ุงููุนููุฉ
        โ
ุงููุคุดุฑ ูุชุญูู ุฅูู ุญุงูุฉ "ุฌุงุฑู ุงููุฒุงููุฉ"
        โ
ุนูุฏ ุงูุงูุชูุงุก โ ุงููุคุดุฑ ูุนุฑุถ "ุชูุช ุงููุฒุงููุฉ โ"
```

---

## ๐ ููุงุฑูุฉ ูุจู ูุจุนุฏ

| ุงูููุฒุฉ | ูุจู | ุจุนุฏ |
|--------|-----|-----|
| **ูุคุดุฑ ุงููุฒุงููุฉ** | โ ููุฌูุฏ ููู ุจุณูุท | โ ูุนุฑุถ ุญุงูุงุช ุฏูููุฉ |
| **ููุช ุขุฎุฑ ูุฒุงููุฉ** | โ ูุง ูุนุฑุถ ุฏุงุฆูุงู | โ ูุนุฑุถ ูู Success ู Partial |
| **ุงูููุฑ ุนูู ุงููุคุดุฑ** | โ ูุง ููุนู ุดูุก | โ ููุชุญ ูุงูุฐุฉ ุชูุงุตูู |
| **ุฒุฑ ุงููุฒุงููุฉ ุงูููุฑูุฉ** | โ ุบูุฑ ููุฌูุฏ | โ ููุฌูุฏ ููุนูู |
| **ุฑุณุงูุฉ ุชุฃููุฏ** | โ ูุง ุชูุฌุฏ | โ "ุจุฏุฃุช ุงููุฒุงููุฉ..." |
| **ุชุญุฏูุซ ุชููุงุฆู ูููุคุดุฑ** | โ๏ธ ุฌุฒุฆู | โ ูุงูู ูุน BlocBuilder |

---

## ๐จ ุงูุชุตููู

### ููููุงุช `SyncDetailsSheet` (ููุฌูุฏุฉ ูุณุจูุงู ูู `sync_indicator.dart`)

ุชุญุชูู ุนูู:
1. **ุฑุฃุณ (Header):**
   - ุฃููููุฉ ูุจูุฑุฉ (๐ ุฃู โ๏ธ)
   - ุนููุงู "ุฌุงุฑู ุงููุฒุงููุฉ" ุฃู "ุญุงูุฉ ุงููุฒุงููุฉ"
   - ููุช ุขุฎุฑ ูุฒุงููุฉ

2. **ุฅุญุตุงุฆูุงุช (Stats):**
   - ุนุฏุฏ ุงูุนูุงุตุฑ ุงููุชุฒุงููุฉ โ
   - ุนุฏุฏ ุงูุนูุงุตุฑ ุงููุนููุฉ โณ

3. **ุฒุฑ ุงูุฅุฌุฑุงุก:**
   - "ุจุฏุก ุงููุฒุงููุฉ" (ุนูุฏ ุนุฏู ูุฌูุฏ ูุฒุงููุฉ)
   - "ุฌุงุฑู ุงููุฒุงููุฉ..." (ุนูุฏ ูุฌูุฏ ูุฒุงููุฉ)
   - ูุนุทู ุฃุซูุงุก ุงููุฒุงููุฉ

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงูุฎุทูุงุช:

1. **ุงูุชุญ ุงูุชุทุจูู:**
   ```
   โ ูุฌุจ ุฃู ุชุฑู ูุคุดุฑ ุงููุฒุงููุฉ ูู AppBar ูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ
   ```

2. **ุงููุฑ ุนูู ุงููุคุดุฑ:**
   ```
   โ ูุฌุจ ุฃู ุชุธูุฑ ูุงูุฐุฉ ููุจุซูุฉ ุฌูููุฉ ุจุชูุงุตูู ุงููุฒุงููุฉ
   ```

3. **ุงุถุบุท "ุจุฏุก ุงููุฒุงููุฉ":**
   ```
   โ ูุฌุจ ุฃู ุชุจุฏุฃ ุงููุฒุงููุฉ ููุฑุงู
   โ ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ "ุจุฏุฃุช ุงููุฒุงููุฉ..."
   โ ุงููุคุดุฑ ูุชุญูู ุฅูู ุฃููููุฉ ุฏููุงุฑุฉ
   ```

4. **ุงูุชุธุฑ ุงูุชูุงุก ุงููุฒุงููุฉ:**
   ```
   โ ุงููุคุดุฑ ูุนุฑุถ โ "ุชูุช ุงููุฒุงููุฉ"
   โ ุงููุงูุฐุฉ ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุชููุงุฆูุงู
   ```

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### 1. ุงูุฅุญุตุงุฆูุงุช

ุญุงููุงู ุงูุฃุฑูุงู ุซุงุจุชุฉ ููุชูุถูุญ:
```dart
if (state is SyncSuccess) {
  itemsSynced = 100; // โ ูููู ุงูุญุตูู ุนูู ุงููููุฉ ุงูุญููููุฉ ูู state
}
```

**ููุชุญุณูู ุงููุณุชูุจูู:**
- ุฅุถุงูุฉ `itemsSynced` ู `itemsPending` ูู `SyncState`
- ุชุญุฏูุซ `SyncBloc` ูุชุชุจุน ุงูุฃุฑูุงู ุงูุญููููุฉ

---

### 2. ุงูุญูุงุธ ุนูู ููุช ุงููุฒุงููุฉ

ุญุงููุงู ูุณุชุฎุฏู `DateTime.now()` ุนูุฏ ุงููุฌุงุญุ ููู ููููุฏ ุนูุฏ ุฅุนุงุฏุฉ ุงูุจูุงุก.

**ุงูุญู ุงูููุตู ุจู:**
- ุฅุถุงูุฉ `lastSyncTime` ูู `SyncState`
- ุญูุธูุง ูู SharedPreferences
- ุชุญููููุง ุนูุฏ ุจุฏุก ุงูุชุทุจูู

---

### 3. ุฃููุงุน ุงููุฒุงููุฉ

ูููู ุงูุชูููุฒ ุจูู:
- **ูุฒุงููุฉ ูุงููุฉ:** `StartSync(fullSync: true)`
- **ูุฒุงููุฉ ุฌุฒุฆูุฉ:** `StartSync(fullSync: false)`
- **ูุฒุงููุฉ ุชููุงุฆูุฉ:** ูู ุฎูุงู `SyncManager.startAuto()`

---

## โ ุงูุฎูุงุตุฉ

| ุงูููุฒุฉ | ุงูุญุงูุฉ |
|--------|--------|
| ูุคุดุฑ ุงููุฒุงููุฉ ูู AppBar | โ ูุญุณูู |
| ุนุฑุถ ููุช ุขุฎุฑ ูุฒุงููุฉ | โ ูุนูู |
| ูุงูุฐุฉ ุชูุงุตูู ุงููุฒุงููุฉ | โ ุชุนูู |
| ุฒุฑ ุงููุฒุงููุฉ ุงูููุฑูุฉ | โ ูุนูู |
| ุฑุณุงูุฉ ุชุฃููุฏ | โ ุชุธูุฑ |
| ุชุญุฏูุซ ุชููุงุฆู ูููุคุดุฑ | โ ูุนูู |
| ุฑุจุท ูุน SyncBloc | โ ูุฑุจูุท |

**ุงููุชูุฌุฉ:** 
ุงููุณุชุฎุฏู ุงูุขู ููููู:
1. โ ุฑุคูุฉ ุญุงูุฉ ุงููุฒุงููุฉ ูู AppBar
2. โ ุงูููุฑ ุนูู ุงููุคุดุฑ ูุฑุคูุฉ ุงูุชูุงุตูู
3. โ ุงูุถุบุท ุนูู ุฒุฑ "ุจุฏุก ุงููุฒุงููุฉ" ููุฒุงููุฉ ููุฑูุฉ
4. โ ุฑุคูุฉ ุชุญุฏูุซุงุช ุญูุฉ ููุญุงูุฉ

---

**ุชู ุงูุชูููุฐ ุจูุงุณุทุฉ:** Verdent AI  
**ุชุงุฑูุฎ:** 2025-11-11  
**ุงูููู ุงูููุนุฏูู:** `lib/presentation/screens/home/home_screen.dart`  
**ุนุฏุฏ ุงูุชุนุฏููุงุช:** 3
